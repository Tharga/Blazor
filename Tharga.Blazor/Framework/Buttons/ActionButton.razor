@using System.Diagnostics
<StandardButton Text="@Text" Icon="@Icon" Click="@ClickWrapper" Type="@StandardButton.EButtonType.Normal" Variant="@GetVariant()" Enabled="@Enabled" IsBusy="@_executing" BusyText="@GetBusyText()" Style="@Style" Visible="@Visible" />

@code {
    private bool _executing;

    [Parameter]
    public string Text { get; set; }

    [Parameter]
    public string BusyText { get; set; }

    [Parameter]
    public string Icon { get; set; }

    [Parameter]
    public Func<Task> Click { get; set; }

    [Parameter]
    public bool Enabled { get; set; } = true;

    [Parameter]
    public TimeSpan Delay { get; set; } = TimeSpan.Zero;

    [Parameter]
    public string Style { get; set; }

    [Parameter]
    public bool Visible { get; set; }

    [Parameter]
    public Variant? Variant { get; set; }

    private string GetBusyText() => BusyText ?? Text;
    private Variant GetVariant() => Variant ?? Radzen.Variant.Filled;

    private async Task ClickWrapper()
    {
        try
        {
            _executing = true;
            StateHasChanged();

            await Task.Delay(Delay);

            await Click();
        }
        catch (Exception e)
        {
            //TODO: Show toaster here
            Debugger.Break();
            throw;
        }
        finally
        {
            _executing = false;
            StateHasChanged();
        }
    }

}
